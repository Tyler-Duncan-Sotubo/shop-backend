import { db as DbType } from 'src/infrastructure/drizzle/types/drizzle';
import { AwsService } from 'src/infrastructure/aws/aws.service';
import { InvoiceService } from '../../invoice/invoice.service';
import { FinalizeBankTransferPaymentInput, ListPaymentsQueryInput, PaystackSuccessInput } from '../inputs';
export declare class PaymentService {
    private readonly db;
    private readonly aws;
    private readonly invoiceService;
    constructor(db: DbType, aws: AwsService, invoiceService: InvoiceService);
    listPayments(companyId: string, filter: ListPaymentsQueryInput): Promise<{
        id: string;
        companyId: string;
        orderId: string | null;
        invoiceId: string | null;
        method: "pos" | "bank_transfer" | "cash" | "manual" | "gateway";
        status: "pending" | "succeeded" | "reversed";
        currency: string;
        amountMinor: number;
        reference: string | null;
        provider: string | null;
        providerRef: string | null;
        providerEventId: string | null;
        receivedAt: Date | null;
        confirmedAt: Date | null;
        createdByUserId: string | null;
        confirmedByUserId: string | null;
        meta: unknown;
        createdAt: Date;
    }[]>;
    recordInvoicePayment(dto: {
        invoiceId: string;
        amount: number;
        currency: string;
        method: 'bank_transfer' | 'cash' | 'card_manual' | 'other';
        reference?: string | null;
        meta?: any;
        evidenceDataUrl?: string;
        evidenceFileName?: string;
        evidenceNote?: string;
    }, companyId: string, userId: string): Promise<{
        invoice: {
            id: string;
            companyId: string;
            storeId: string | null;
            orderId: string | null;
            quoteRequestId: string | null;
            type: "invoice" | "credit_note";
            status: "draft" | "issued" | "partially_paid" | "paid" | "void";
            customerId: string | null;
            billingAddressId: string | null;
            shippingAddressId: string | null;
            customerSnapshot: unknown;
            supplierSnapshot: unknown;
            seriesId: string | null;
            sequenceNumber: number | null;
            number: string | null;
            issuedAt: Date | null;
            dueAt: Date | null;
            currency: string;
            exchangeRate: string | null;
            subtotalMinor: number;
            discountMinor: number;
            shippingMinor: number;
            taxMinor: number;
            adjustmentMinor: number;
            roundingMinor: number;
            totalMinor: number;
            paidMinor: number;
            balanceMinor: number;
            lockedAt: Date | null;
            voidedAt: Date | null;
            voidReason: string | null;
            meta: unknown;
            createdAt: Date;
            updatedAt: Date;
        };
        paymentId: string;
        receipt: any;
        receiptId: any;
        appliedMinor: number;
        evidence: any;
    }>;
    handlePaystackSuccess(dto: PaystackSuccessInput, companyId: string, userId: string): Promise<{
        paymentId: string;
        alreadyProcessed: boolean;
        invoice?: undefined;
        receipt?: undefined;
    } | {
        invoice: {
            id: string;
            companyId: string;
            storeId: string | null;
            orderId: string | null;
            quoteRequestId: string | null;
            type: "invoice" | "credit_note";
            status: "draft" | "issued" | "partially_paid" | "paid" | "void";
            customerId: string | null;
            billingAddressId: string | null;
            shippingAddressId: string | null;
            customerSnapshot: unknown;
            supplierSnapshot: unknown;
            seriesId: string | null;
            sequenceNumber: number | null;
            number: string | null;
            issuedAt: Date | null;
            dueAt: Date | null;
            currency: string;
            exchangeRate: string | null;
            subtotalMinor: number;
            discountMinor: number;
            shippingMinor: number;
            taxMinor: number;
            adjustmentMinor: number;
            roundingMinor: number;
            totalMinor: number;
            paidMinor: number;
            balanceMinor: number;
            lockedAt: Date | null;
            voidedAt: Date | null;
            voidReason: string | null;
            meta: unknown;
            createdAt: Date;
            updatedAt: Date;
        };
        paymentId: string;
        receipt: any;
        alreadyProcessed: boolean;
    }>;
    private uploadPaymentEvidenceTx;
    private allocatePaymentToInvoiceTx;
    private formatReceiptNumber;
    private nextReceiptSequenceTx;
    private createReceiptForPaymentTx;
    finalizePendingBankTransferPayment(dto: FinalizeBankTransferPaymentInput, companyId: string, userId: string): Promise<{
        paymentId: any;
        receipt: {
            id: string;
            companyId: string;
            paymentId: string;
            invoiceId: string | null;
            orderId: string | null;
            invoiceNumber: string | null;
            orderNumber: string | null;
            sequenceNumber: number;
            receiptNumber: string;
            currency: string;
            amountMinor: number;
            pdfUrl: string | null;
            pdfStorageKey: string | null;
            method: "pos" | "bank_transfer" | "cash" | "manual" | "gateway";
            reference: string | null;
            customerSnapshot: unknown;
            storeSnapshot: unknown;
            meta: unknown;
            issuedAt: Date;
            createdByUserId: string | null;
            createdAt: Date;
            updatedAt: Date;
        };
        alreadyConfirmed: boolean;
        receiptId?: undefined;
    } | {
        paymentId: any;
        receiptId: any;
        receipt: any;
        alreadyConfirmed: boolean;
    }>;
    presignPaymentEvidenceUpload(params: {
        companyId: string;
        paymentId: string;
        fileName: string;
        mimeType: string;
        expiresInSeconds?: number;
        publicRead?: boolean;
        requirePendingBankTransfer?: boolean;
    }): Promise<{
        upload: {
            key: string;
            fileName: string;
            mimeType: string;
            uploadUrl: string;
            url: string;
        };
    }>;
    finalizePaymentEvidenceUpload(params: {
        companyId: string;
        paymentId: string;
        key: string;
        url?: string | null;
        fileName?: string | null;
        mimeType?: string | null;
        note?: string | null;
        uploadedByUserId?: string | null;
        requirePendingBankTransfer?: boolean;
    }): Promise<{
        id: string;
        createdAt: Date;
        companyId: string;
        fileName: string;
        mimeType: string;
        url: string;
        note: string | null;
        kind: string;
        paymentId: string;
        sizeBytes: number | null;
        uploadedByUserId: string | null;
    }>;
}
